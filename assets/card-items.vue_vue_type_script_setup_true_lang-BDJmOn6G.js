import{$ as m}from"./TranslationUtil-FtQ1dQ9j.js";import{d as Ce,r as k,X as he,w as we,G as ke,ai as Ae,g as A,f as a,a as Ne,o as $,b as t,t as i,v as u,m as o,c as S,F as O,i as oe,l as T,di as w,e as ne,q as se,$ as B,ah as P}from"./index-otdAmfct.js";import{_ as Te}from"./AppTextarea.vue_vue_type_script_setup_true_lang-djBoE35F.js";import{_ as Ie}from"./AppTextField.vue_vue_type_script_setup_true_lang-B5-sMlJh.js";import{_ as Ue}from"./AppAutocomplete.vue_vue_type_script_setup_true_lang-Cm7k4wFu.js";import{c as y}from"./common-api.web.min-7qNUJA33.js";import{d as _}from"./PriceUtil-BH5aO6wB.js";import{u as Le,a as Ee,b as Se}from"./catalog-wnnJAoFL.js";import{V as Fe,c as Ke}from"./VCard-Bhbbr4LO.js";import{V as He}from"./VCardText-C9D5-5fO.js";import{V,a as n}from"./VRow-C4V377Vp.js";import{c as de,a as re,b as ie}from"./VList-DkJCWcOj.js";import{V as x}from"./VSpacer-CihG0cV7.js";import{V as qe}from"./VSelect-BglTtTFd.js";const De={class:"w-100"},Re={class:"w-100"},tt=Ce({__name:"card-items",props:{serviceType:{type:String,default:()=>y.Api.HubriseServiceType.DELIVERY},reset:{type:Number,default:()=>0}},emits:["create"],setup(j,{emit:ue}){var ae;const F=j,ce=ue,f=((ae=Le().getCurrentAccount)==null?void 0:ae.currency)??y.Api.HubriseCurrencyCode.EUR,Y=Ee(),z=Se(),K=k(),C=k(),H=k(!1);let X=[],I=[],G={},N={};const b=k([{}]),U=k(),L=k(),E=k(`0.00 ${f}`),M=k([{value:`0.00 ${f}`,name:_(`0.00 ${f}`)},{value:`1.00 ${f}`,name:_(`1.00 ${f}`)},{value:`2.00 ${f}`,name:_(`2.00 ${f}`)},{value:`3.00 ${f}`,name:_(`3.00 ${f}`)},{value:`4.00 ${f}`,name:_(`4.00 ${f}`)},{value:`5.00 ${f}`,name:_(`5.00 ${f}`)}]),me=()=>{if(!(!Array.isArray(b.value)||b.value.length===0))return b.value.filter(e=>"id"in e&&e.id!==void 0&&e.id!==null).length===0},q=he(()=>{const e={service_type:F.serviceType,items:b.value},l=new y.Api.TotalHubriseCalculator().calculateTotals(e,f);return E.value=l.deliveryFee,l}),J=e=>{if(typeof e=="object"&&e!==null)switch(F.serviceType){case y.Api.HubriseServiceType.DELIVERY:return`${e.delivery}%`;case y.Api.HubriseServiceType.COLLECTION:return`${e.collection}%`;case y.Api.HubriseServiceType.EAT_IN:return`${e.eat_in}%`}return""},pe=()=>{if(C.value===void 0||C.value===null)return;const l=new y.Api.HubriseCatalogConverter().editableItems(C.value);X=l.withRef,I=l.withName},fe=()=>{if(C.value===void 0||C.value===null)return;const l=new y.Api.HubriseCatalogConverter().editableItemOptions(C.value);G=l.withRef,N=l.withName},D=()=>{b.value.push({})},ve=e=>{const l=b.value.findIndex(r=>r===e);l>=0&&b.value.splice(l,1)},R=e=>{Array.isArray(e.options)||(e.options=[]),e.options.push({})},ge=(e,l)=>{const r=e.options.findIndex(c=>c===l);r>=0&&e.options.splice(r,1)},Q=(e,l)=>{const r=I==null?void 0:I.find(c=>c.id===e);r===void 0?Object.keys(l).forEach(c=>delete l[c]):(y.Util.ObjectUtil.update(l,r),Array.isArray(N[e])&&N[e].length>0?R(l):D())},W=(e,l,r)=>{var v;const c=(v=N[e])==null?void 0:v.find(g=>g.id===l);if(c===void 0)Object.keys(r).forEach(g=>delete r[g]);else{const g=b.value.find(s=>s.id===e);y.Util.ObjectUtil.update(r,c),R(g)}},ye=()=>{H.value=!0,ce("create",{items:b.value,customerNotes:U.value,sellerNotes:L.value})},Z=e=>{const l=e.target;l.tagName==="INPUT"||l.tagName==="TEXTAREA"||l.isContentEditable||(e.key==="+"||e.key==="Add"||e.code==="NumpadAdd"||e.shiftKey&&(e.key==="="||e.code==="Equal"))&&D()},ee=e=>{K.value=e},te=e=>{C.value=e,pe(),fe()},_e=(e,l,r)=>{var s;const c=l.toLowerCase(),v=(s=r.raw.category_name)==null?void 0:s.toLowerCase(),g=r.raw.product_name.toLowerCase();return(v==null?void 0:v.includes(c))||g.includes(c)},$e=(e,l)=>{const r=l.findIndex(c=>c.category_name===e.category_name&&c.product_name===e.product_name);return r===0||l[r-1].category_name!==e.category_name},be=(e,l,r)=>{const c=l.toLowerCase(),v=r.raw.option_list_name.toLowerCase(),g=r.raw.name.toLowerCase();return v.includes(c)||g.includes(c)},Ve=(e,l)=>{const r=l.findIndex(c=>c.option_list_name===e.option_list_name&&c.name===e.name);return r===0||l[r-1].option_list_name!==e.option_list_name},h=e=>{if(e.key==="Enter"&&!e.shiftKey){e.preventDefault();const l=Array.from(document.querySelectorAll('input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), [tabindex]:not([tabindex="-1"])')).filter(v=>v.offsetParent!==null),r=l.indexOf(e.target),c=l[r+1];c&&c.focus()}};return we(()=>F.reset,()=>{b.value=[],U.value="",L.value="",E.value=`0.00 ${f}`,H.value=!1}),ke(()=>{window.addEventListener("keydown",Z),Y.onCurrentLocationChange(ee),z.onCurrentCatalogChange(te)}),Ae(()=>{window.removeEventListener("keydown",Z),Y.offCurrentLocationChange(ee),z.offCurrentCatalogChange(te)}),(e,l)=>{const r=Ue,c=Ie,v=Ne("IconBtn"),g=Te;return $(),A(Fe,{disabled:!K.value||!C.value,loading:!K.value||!C.value},{default:a(()=>[t(Ke,null,{default:a(()=>[i(u(("$t"in e?e.$t:o(m))("page.order.add.section.item.title")),1)]),_:1}),t(He,null,{default:a(()=>[t(V,{dense:""},{default:a(()=>[t(n,{cols:"2",md:"2"},{default:a(()=>[i(u(("$t"in e?e.$t:o(m))("page.order.add.section.item.reference")),1)]),_:1}),t(n,{cols:"2",md:"4"},{default:a(()=>[i(u(("$t"in e?e.$t:o(m))("page.order.add.section.item.name")),1)]),_:1}),t(n,{cols:"2",md:"1"},{default:a(()=>[i(u(("$t"in e?e.$t:o(m))("page.order.add.section.item.quantity")),1)]),_:1}),t(n,{cols:"2",md:"1"},{default:a(()=>[i(u(("$t"in e?e.$t:o(m))("page.order.add.section.item.vat")),1)]),_:1}),t(n,{cols:"1",md:"1"},{default:a(()=>[i(u(("$t"in e?e.$t:o(m))("page.order.add.section.item.price")),1)]),_:1}),t(n,{class:"text-center",cols:"2",md:"2"},{default:a(()=>[i(u(("$t"in e?e.$t:o(m))("page.order.add.section.item.subtotal")),1)]),_:1}),t(n,{cols:"1",md:"1"})]),_:1}),($(!0),S(O,null,oe(b.value,s=>($(),S(O,{key:s.id},[t(V,{dense:""},{default:a(()=>[t(n,{cols:"4",md:"2"},{default:a(()=>[s.sku_ref!==null?($(),A(r,{key:0,modelValue:s.sku_ref,"onUpdate:modelValue":[d=>s.sku_ref=d,d=>Q(d,s)],items:o(X),placeholder:("$t"in e?e.$t:o(m))("page.order.add.section.item.reference"),"item-title":"sku_ref","item-value":"id","no-data-text":"common.component.noData",onKeyup:w(h,["enter"])},null,8,["modelValue","onUpdate:modelValue","items","placeholder"])):T("",!0)]),_:2},1024),t(n,{cols:"6",md:"4"},{default:a(()=>[t(r,{modelValue:s.product_name,"onUpdate:modelValue":[d=>s.product_name=d,d=>Q(d,s)],"custom-filter":_e,items:o(I),placeholder:("$t"in e?e.$t:o(m))("page.order.add.section.item.name"),"item-title":"product_name","item-value":"id","no-data-text":"common.component.noData",onKeyup:w(h,["enter"])},{item:a(({props:d,item:p})=>[ne("div",De,[$e(p.raw,o(I))?($(),A(de,{key:0,class:"text-primary font-weight-bold"},{default:a(()=>[i(u(p.raw.category_name),1)]),_:2},1024)):T("",!0),t(re,se({class:"ps-8",ref_for:!0},d),{default:a(()=>[t(ie)]),_:2},1040)])]),selection:a(({item:d})=>[i(u(d.title),1)]),_:2},1032,["modelValue","onUpdate:modelValue","items","placeholder"])]),_:2},1024),t(n,{cols:"2",md:"1"},{default:a(()=>[t(c,{modelValue:s.quantity,"onUpdate:modelValue":d=>s.quantity=d,clearable:!1,min:"1",placeholder:"1",type:"number",onKeyup:w(h,["enter"])},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(n,{class:"align-self-end",cols:"3",md:"1"},{default:a(()=>[i(u(J(s.tax_rate)),1)]),_:2},1024),t(n,{class:"align-self-end",cols:"3",md:"1"},{default:a(()=>[i(u(o(_)(s.price)),1)]),_:2},1024),t(n,{class:"align-self-end text-center",cols:"3",md:"2"},{default:a(()=>[i(u(o(_)(o(y.Api).HubrisePriceUtil.multiply(s.price,s.quantity))),1)]),_:2},1024),t(n,{class:"px-0",cols:"3",md:"1"},{default:a(()=>[t(v,{"x-small":"",onClick:d=>s.customer_notes=s.customer_notes===void 0?null:void 0},{default:a(()=>[t(B,{icon:"bx-edit"})]),_:2},1032,["onClick"]),t(v,{onClick:d=>ve(s)},{default:a(()=>[t(B,{icon:"bx-trash"})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024),($(!0),S(O,null,oe(s.options,d=>($(),S("div",{key:d.ref},[t(V,{dense:""},{default:a(()=>[t(n,{class:"d-flex align-self-end",cols:"4",md:"2"},{default:a(()=>[t(x),d.ref!==null?($(),A(r,{key:0,modelValue:d.ref,"onUpdate:modelValue":[p=>d.ref=p,p=>W(s.id,p,d)],items:o(G)[s.id],placeholder:("$t"in e?e.$t:o(m))("page.order.add.section.item.reference"),"item-title":"ref","item-value":"id","no-data-text":"common.component.noData",onKeyup:w(h,["enter"])},null,8,["modelValue","onUpdate:modelValue","items","placeholder"])):T("",!0)]),_:2},1024),t(n,{class:"d-flex align-self-end",cols:"6",md:"4"},{default:a(()=>[t(x),t(r,{modelValue:d.name,"onUpdate:modelValue":[p=>d.name=p,p=>W(s.id,p,d)],"custom-filter":be,items:o(N)[s.id],placeholder:("$t"in e?e.$t:o(m))("page.order.add.section.item.name"),"item-title":"name","item-value":"id","no-data-text":"common.component.noData",onKeyup:w(h,["enter"])},{item:a(({props:p,item:le})=>[ne("div",Re,[Ve(le.raw,o(N)[s.id])?($(),A(de,{key:0,class:"text-primary font-weight-bold"},{default:a(()=>[i(u(le.raw.option_list_name),1)]),_:2},1024)):T("",!0),t(re,se({class:"ps-8",ref_for:!0},p),{default:a(()=>[t(ie)]),_:2},1040)])]),selection:a(({item:p})=>[i(u(p.title),1)]),_:2},1032,["modelValue","onUpdate:modelValue","items","placeholder"])]),_:2},1024),t(n,{class:"d-flex align-self-end",cols:"2",md:"1"},{default:a(()=>[t(c,{modelValue:d.quantity,"onUpdate:modelValue":p=>d.quantity=p,clearable:!1,min:"1",placeholder:"1",type:"number",onKeyup:w(h,["enter"])},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(n,{class:"align-self-end",cols:"3",md:"1"},{default:a(()=>[i(u(J(s.tax_rate)),1)]),_:2},1024),t(n,{class:"align-self-end",cols:"3",md:"1"},{default:a(()=>[i(u(o(_)(d.price)),1)]),_:2},1024),t(n,{class:"align-self-end text-center",cols:"3",md:"2"},{default:a(()=>[i(u(o(_)(o(y.Api).HubrisePriceUtil.multiply(d.price,d.quantity))),1)]),_:2},1024),t(n,{cols:"3",md:"1"},{default:a(()=>[t(v,{onClick:p=>ge(s,d)},{default:a(()=>[t(B,{icon:"bx-trash"})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]))),128)),t(V,{dense:""},{default:a(()=>[t(n,{cols:"0",md:"2"}),t(n,{cols:"12",md:"5"},{default:a(()=>{var d;return[((d=o(N)[s.id])==null?void 0:d.length)>0?($(),A(P,{key:0,class:"mt-6",color:"secondary","prepend-icon":"bx-plus",size:"x-small",onClick:p=>R(s)},{default:a(()=>[i(u(("$t"in e?e.$t:o(m))("page.order.add.section.item.button.add.itemOption")),1)]),_:2},1032,["onClick"])):T("",!0)]}),_:2},1024),t(n,{cols:"12",md:"4"},{default:a(()=>[s.customer_notes!==void 0?($(),A(g,{key:0,modelValue:s.customer_notes,"onUpdate:modelValue":d=>s.customer_notes=d,label:("$t"in e?e.$t:o(m))("page.order.add.section.item.itemNotes"),placeholder:("$t"in e?e.$t:o(m))("page.order.add.section.item.itemNotes"),"auto-grow":"",counter:"",maxlength:"300",rows:"1",onKeyup:w(h,["enter"])},null,8,["modelValue","onUpdate:modelValue","label","placeholder"])):T("",!0)]),_:2},1024),t(n,{cols:"0",md:"1"})]),_:2},1024)],64))),128)),t(V,{dense:""},{default:a(()=>[t(n,{cols:"12"},{default:a(()=>[t(P,{class:"mt-6",color:"secondary","prepend-icon":"bx-plus",size:"small",onClick:D},{default:a(()=>[i(u(("$t"in e?e.$t:o(m))("page.order.add.section.item.button.add.item")),1)]),_:1})]),_:1}),t(n,{class:"px-4 py-8",cols:"6",md:"3"},{default:a(()=>[t(g,{modelValue:U.value,"onUpdate:modelValue":l[0]||(l[0]=s=>U.value=s),label:("$t"in e?e.$t:o(m))("page.order.add.section.item.customerNotes"),placeholder:("$t"in e?e.$t:o(m))("page.order.add.section.item.customerNotes"),"auto-grow":"",counter:"",maxlength:"500",rows:"4",onKeyup:w(h,["enter"])},null,8,["modelValue","label","placeholder"])]),_:1}),t(n,{class:"px-4 py-8",cols:"6",md:"3"},{default:a(()=>[t(x),t(g,{modelValue:L.value,"onUpdate:modelValue":l[1]||(l[1]=s=>L.value=s),label:("$t"in e?e.$t:o(m))("page.order.add.section.item.sellerNotes"),placeholder:("$t"in e?e.$t:o(m))("page.order.add.section.item.sellerNotes"),"auto-grow":"",counter:"",maxlength:"500",rows:"4",onKeyup:w(h,["enter"])},null,8,["modelValue","label","placeholder"])]),_:1}),t(n,{cols:"0",md:"1"}),t(n,{cols:"12",md:"5"},{default:a(()=>[t(V,{dense:""},{default:a(()=>[t(n,{class:"align-self-end",cols:"6",md:"5"},{default:a(()=>[i(u(("$t"in e?e.$t:o(m))("page.order.add.section.item.subtotal")),1)]),_:1}),t(n,{class:"text-center",cols:"6",md:"4"},{default:a(()=>[i(u(o(_)(o(q).subtotal)),1)]),_:1}),t(n,{cols:"0",md:"3"})]),_:1}),t(V,{dense:""},{default:a(()=>[t(n,{class:"align-self-end",cols:"6",md:"5"},{default:a(()=>[i(u(("$t"in e?e.$t:o(m))("page.order.add.section.item.minimumOrderFee")),1)]),_:1}),t(n,{class:"text-center",cols:"6",md:"4"},{default:a(()=>[i(u(o(_)(o(q).minimumOrderFee)),1)]),_:1}),t(n,{cols:"0",md:"3"})]),_:1}),j.serviceType===o(y.Api).HubriseServiceType.DELIVERY?($(),A(V,{key:0,dense:""},{default:a(()=>[t(n,{class:"align-self-end",cols:"6",md:"5"},{default:a(()=>[i(u(("$t"in e?e.$t:o(m))("page.order.add.section.item.deliveryFee")),1)]),_:1}),t(n,{class:"text-center pa-0",cols:"6",md:"4"},{default:a(()=>[t(qe,{modelValue:E.value,"onUpdate:modelValue":l[2]||(l[2]=s=>E.value=s),disabled:!0,items:M.value,loading:M.value.length===0,class:"d-inline-flex","item-title":"name","item-value":"value",variant:"plain"},null,8,["modelValue","items","loading"])]),_:1}),t(n,{cols:"0",md:"3"})]),_:1})):T("",!0),t(V,{dense:""},{default:a(()=>[t(n,{class:"align-self-end",cols:"6",md:"5"},{default:a(()=>[i(u(("$t"in e?e.$t:o(m))("page.order.add.section.item.total")),1)]),_:1}),t(n,{class:"text-center",cols:"6",md:"4"},{default:a(()=>[i(u(o(_)(o(q).total)),1)]),_:1}),t(n,{cols:"0",md:"3"})]),_:1}),t(V,{dense:""},{default:a(()=>[t(n,{cols:"12",md:"9"},{default:a(()=>[t(P,{disabled:me(),loading:H.value,class:"w-100",onClick:ye},{default:a(()=>[i(u(("$t"in e?e.$t:o(m))("page.order.add.button.create")),1)]),_:1},8,["disabled","loading"])]),_:1}),t(n,{cols:"0",md:"3"})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["disabled","loading"])}}});export{tt as _};
