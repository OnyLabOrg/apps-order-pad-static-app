import{$ as m}from"./TranslationUtil-C1IgvA0R.js";import{d as Fe,r as b,X as Ie,w as Ne,G as Le,ai as Se,g as h,f as a,a as Ee,o as y,b as t,t as d,v as u,m as l,c as D,F as j,i as ue,l as U,di as w,e as Y,q as ce,$ as x,ah as z}from"./index-P0BCKbHe.js";import{_ as He}from"./AppTextarea.vue_vue_type_script_setup_true_lang-Cidg2KF5.js";import{_ as Pe}from"./AppTextField.vue_vue_type_script_setup_true_lang-B6AQ_Adv.js";import{_ as Oe}from"./AppAutocomplete.vue_vue_type_script_setup_true_lang-Pu8e6Xwn.js";import{c as p}from"./common-api.web.min-CNoIadEv.js";import{d as A}from"./PriceUtil-Djy3Ejhg.js";import{a as De,d as Ke,f as Re}from"./Http-BcfoffHH.js";import{L as me}from"./LocationSettingService-CNOW2VaB.js";import{V as qe,c as Be}from"./VCard-CGivmTl2.js";import{V as je}from"./VCardText-Dcpomc9w.js";import{V,a as s}from"./VRow-CBrh0fFK.js";import{c as pe,a as fe,b as ve}from"./VList-CrfzyPEE.js";import{V as M}from"./VSpacer-NiJD0osM.js";import{V as Ye}from"./VSelect-vc8T6kj3.js";const xe={class:"w-100"},ze={class:"w-100"},dt=Fe({__name:"card-items",props:{serviceType:{type:String,default:()=>p.Api.HubriseServiceType.DELIVERY},reset:{type:Number,default:()=>0}},emits:["create","nextField"],setup(X,{emit:ge}){var ie;const K=X,G=ge,L=((ie=De().getCurrentAccount)==null?void 0:ie.currency)??p.Api.HubriseCurrencyCode.EUR,I=p.Api.HubrisePriceUtil.amountToPrice(0,L),J=Ke(),Q=Re(),S=b(),$=b(),E=b(!1);let W=[],N=[],Z={},k={};const _=b([{}]),H=b(),P=b(),ee=b(),R=b(I),te=b(),F=b(I),O=b([{value:I,name:A(I)}]),ye=()=>{if(!(!Array.isArray(_.value)||_.value.length===0))return _.value.filter(e=>"id"in e&&e.id!==void 0&&e.id!==null).length===0},T=Ie(()=>{const e=S.value,o={service_type:K.serviceType,items:_.value,status:p.Api.HubriseOrderStatus.new},n=new p.Api.TotalHubriseCalculator().calculateTotals(e??void 0,o,te.value,ee.value,L);return o.service_type!==p.Api.HubriseServiceType.DELIVERY&&(F.value=I),F.value!==null?(n.deliveryFee=F.value,n.total=p.Api.HubrisePriceUtil.sum([n.subtotal,n.minimumOrderFee,n.deliveryFee,p.Api.HubrisePriceUtil.multiply(n.totalDiscount,-1)])):F.value=n.deliveryFee??null,n}),ae=e=>{if(typeof e=="object"&&e!==null)switch(K.serviceType){case p.Api.HubriseServiceType.DELIVERY:return`${e.delivery}%`;case p.Api.HubriseServiceType.COLLECTION:return`${e.collection}%`;case p.Api.HubriseServiceType.EAT_IN:return`${e.eat_in}%`}return""},_e=()=>{if($.value===void 0||$.value===null)return;const o=new p.Api.HubriseCatalogConverter().editableItems($.value);W=o.withRef,N=o.withName},be=()=>{if($.value===void 0||$.value===null)return;const o=new p.Api.HubriseCatalogConverter().editableItemOptions($.value);Z=o.withRef,k=o.withName},q=()=>{_.value.push({})},Ve=e=>{const o=_.value.findIndex(n=>n===e);o>=0&&_.value.splice(o,1)},B=e=>{Array.isArray(e.options)||(e.options=[]),e.options.push({})},$e=(e,o)=>{const n=e.options.findIndex(c=>c===o);n>=0&&e.options.splice(n,1)},oe=(e,o)=>{const n=N==null?void 0:N.find(c=>c.id===e);n===void 0?Object.keys(o).forEach(c=>delete o[c]):(p.Util.ObjectUtil.update(o,n),Array.isArray(k[e])&&k[e].length>0?B(o):q())},le=(e,o,n)=>{var g;const c=(g=k[e])==null?void 0:g.find(v=>v.id===o);if(c===void 0)Object.keys(n).forEach(v=>delete n[v]);else{const v=_.value.find(r=>r.id===e);p.Util.ObjectUtil.update(n,c),B(v)}},Ce=()=>{E.value=!0,setTimeout(()=>E.value=!1,1e3);const e=[];T.value.minimumOrderFee!==void 0&&e.push({name:m("page.order.add.section.item.minimumOrderFee"),price:T.value.minimumOrderFee}),T.value.deliveryFee!==void 0&&e.push({name:m("page.order.add.section.item.deliveryFee"),price:T.value.deliveryFee}),G("create",{items:_.value,charges:e,customerNotes:H.value,sellerNotes:P.value})},ne=e=>{const o=e.target;o.tagName==="INPUT"||o.tagName==="TEXTAREA"||o.isContentEditable||(e.key==="+"||e.key==="Add"||e.code==="NumpadAdd"||e.shiftKey&&(e.key==="="||e.code==="Equal"))&&q()},se=e=>{S.value=e},re=e=>{$.value=e,_e(),be()},he=(e,o,n)=>{var r;const c=o.toLowerCase(),g=(r=n.raw.category_name)==null?void 0:r.toLowerCase(),v=n.raw.product_name.toLowerCase();return(g==null?void 0:g.includes(c))||v.includes(c)},we=(e,o)=>{const n=o.findIndex(c=>c.category_name===e.category_name&&c.product_name===e.product_name);return n===0||o[n-1].category_name!==e.category_name},Ae=(e,o,n)=>{const c=o.toLowerCase(),g=n.raw.option_list_name.toLowerCase(),v=n.raw.name.toLowerCase();return g.includes(c)||v.includes(c)},Te=(e,o)=>{const n=o.findIndex(c=>c.option_list_name===e.option_list_name&&c.name===e.name);return n===0||o[n-1].option_list_name!==e.option_list_name},Ue=()=>{R.value=p.Api.HubrisePriceUtil.amountToPrice(0,L),new me("minimum_order_value",void 0,o=>{var n;ee.value=o.setting,o.setting.strategy==="supplement"&&typeof((n=o.setting)==null?void 0:n.minimum)=="number"&&(R.value=p.Api.HubrisePriceUtil.amountToPrice(o.setting.minimum,L))}).loadSetting()},ke=()=>{new me("delivery_fee",void 0,o=>{var n;te.value=o.setting,o.setting.type==="radius"&&Array.isArray((n=o.setting)==null?void 0:n.radiuses)&&o.setting.radiuses.forEach((c,g)=>{g===0&&c.amount===0&&(O.value=[]);const v=p.Api.HubrisePriceUtil.amountToPrice(c.amount,L);O.value.push({value:v,name:A(v)})})}).loadSetting()},C=e=>{G("nextField",e)};return Ne(()=>K.reset,()=>{_.value=[],H.value="",P.value="",F.value=I,E.value=!1}),Le(()=>{window.addEventListener("keydown",ne),J.onCurrentLocationChange(se),Q.onCurrentCatalogChange(re),Ue(),ke()}),Se(()=>{window.removeEventListener("keydown",ne),J.offCurrentLocationChange(se),Q.offCurrentCatalogChange(re)}),(e,o)=>{const n=Oe,c=Pe,g=Ee("IconBtn"),v=He;return y(),h(qe,{disabled:!S.value||!$.value,loading:!S.value||!$.value},{default:a(()=>[t(Be,null,{default:a(()=>[d(u(("$t"in e?e.$t:l(m))("page.order.add.section.item.title")),1)]),_:1}),t(je,null,{default:a(()=>[t(V,{dense:""},{default:a(()=>[t(s,{cols:"2",md:"2"},{default:a(()=>[d(u(("$t"in e?e.$t:l(m))("page.order.add.section.item.reference")),1)]),_:1}),t(s,{cols:"2",md:"4"},{default:a(()=>[d(u(("$t"in e?e.$t:l(m))("page.order.add.section.item.name")),1)]),_:1}),t(s,{cols:"2",md:"1"},{default:a(()=>[d(u(("$t"in e?e.$t:l(m))("page.order.add.section.item.quantity")),1)]),_:1}),t(s,{cols:"2",md:"1"},{default:a(()=>[d(u(("$t"in e?e.$t:l(m))("page.order.add.section.item.vat")),1)]),_:1}),t(s,{cols:"1",md:"1"},{default:a(()=>[d(u(("$t"in e?e.$t:l(m))("page.order.add.section.item.price")),1)]),_:1}),t(s,{class:"text-center",cols:"2",md:"2"},{default:a(()=>[d(u(("$t"in e?e.$t:l(m))("page.order.add.section.item.subtotal")),1)]),_:1}),t(s,{cols:"1",md:"1"})]),_:1}),(y(!0),D(j,null,ue(_.value,r=>(y(),D(j,{key:r.id},[t(V,{dense:""},{default:a(()=>[t(s,{cols:"4",md:"2"},{default:a(()=>[r.sku_ref!==null?(y(),h(n,{key:0,modelValue:r.sku_ref,"onUpdate:modelValue":[i=>r.sku_ref=i,i=>oe(i,r)],items:l(W),placeholder:("$t"in e?e.$t:l(m))("page.order.add.section.item.reference"),"item-title":"sku_ref","item-value":"id","no-data-text":"common.component.noData",onKeyup:w(C,["enter"])},null,8,["modelValue","onUpdate:modelValue","items","placeholder"])):U("",!0)]),_:2},1024),t(s,{cols:"6",md:"4"},{default:a(()=>[t(n,{modelValue:r.product_name,"onUpdate:modelValue":[i=>r.product_name=i,i=>oe(i,r)],"custom-filter":he,items:l(N),placeholder:("$t"in e?e.$t:l(m))("page.order.add.section.item.name"),"item-title":"product_name","item-value":"id","no-data-text":"common.component.noData",onKeyup:w(C,["enter"])},{item:a(({props:i,item:f})=>[Y("div",xe,[we(f.raw,l(N))?(y(),h(pe,{key:0,class:"text-primary font-weight-bold"},{default:a(()=>[d(u(f.raw.category_name),1)]),_:2},1024)):U("",!0),t(fe,ce({class:"ps-8",ref_for:!0},i),{default:a(()=>[t(ve)]),_:2},1040)])]),selection:a(({item:i})=>[d(u(i.title),1)]),_:2},1032,["modelValue","onUpdate:modelValue","items","placeholder"])]),_:2},1024),t(s,{cols:"2",md:"1"},{default:a(()=>[t(c,{modelValue:r.quantity,"onUpdate:modelValue":i=>r.quantity=i,clearable:!1,min:"1",placeholder:"1",type:"number",onKeyup:w(C,["enter"])},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(s,{class:"align-self-end",cols:"3",md:"1"},{default:a(()=>[d(u(ae(r.tax_rate)),1)]),_:2},1024),t(s,{class:"align-self-end",cols:"3",md:"1"},{default:a(()=>[d(u(l(A)(r.price)),1)]),_:2},1024),t(s,{class:"align-self-end text-center",cols:"3",md:"2"},{default:a(()=>[d(u(l(A)(l(p.Api).HubrisePriceUtil.multiply(r.price,r.quantity))),1)]),_:2},1024),t(s,{class:"px-0",cols:"3",md:"1"},{default:a(()=>[t(g,{"x-small":"",onClick:i=>r.customer_notes=r.customer_notes===void 0?null:void 0},{default:a(()=>[t(x,{icon:"bx-edit"})]),_:2},1032,["onClick"]),t(g,{onClick:i=>Ve(r)},{default:a(()=>[t(x,{icon:"bx-trash"})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024),(y(!0),D(j,null,ue(r.options,i=>(y(),D("div",{key:i.ref},[t(V,{dense:""},{default:a(()=>[t(s,{class:"d-flex align-self-end",cols:"4",md:"2"},{default:a(()=>[t(M),i.ref!==null?(y(),h(n,{key:0,modelValue:i.ref,"onUpdate:modelValue":[f=>i.ref=f,f=>le(r.id,f,i)],items:l(Z)[r.id],placeholder:("$t"in e?e.$t:l(m))("page.order.add.section.item.reference"),"item-title":"ref","item-value":"id","no-data-text":"common.component.noData",onKeyup:w(C,["enter"])},null,8,["modelValue","onUpdate:modelValue","items","placeholder"])):U("",!0)]),_:2},1024),t(s,{class:"d-flex align-self-end",cols:"6",md:"4"},{default:a(()=>[t(M),t(n,{modelValue:i.name,"onUpdate:modelValue":[f=>i.name=f,f=>le(r.id,f,i)],"custom-filter":Ae,items:l(k)[r.id],placeholder:("$t"in e?e.$t:l(m))("page.order.add.section.item.name"),"item-title":"name","item-value":"id","no-data-text":"common.component.noData",onKeyup:w(C,["enter"])},{item:a(({props:f,item:de})=>[Y("div",ze,[Te(de.raw,l(k)[r.id])?(y(),h(pe,{key:0,class:"text-primary font-weight-bold"},{default:a(()=>[d(u(de.raw.option_list_name),1)]),_:2},1024)):U("",!0),t(fe,ce({class:"ps-8",ref_for:!0},f),{default:a(()=>[t(ve)]),_:2},1040)])]),selection:a(({item:f})=>[d(u(f.title),1)]),_:2},1032,["modelValue","onUpdate:modelValue","items","placeholder"])]),_:2},1024),t(s,{class:"d-flex align-self-end",cols:"2",md:"1"},{default:a(()=>[t(c,{modelValue:i.quantity,"onUpdate:modelValue":f=>i.quantity=f,clearable:!1,min:"1",placeholder:"1",type:"number",onKeyup:w(C,["enter"])},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(s,{class:"align-self-end",cols:"3",md:"1"},{default:a(()=>[d(u(ae(r.tax_rate)),1)]),_:2},1024),t(s,{class:"align-self-end",cols:"3",md:"1"},{default:a(()=>[d(u(l(A)(i.price)),1)]),_:2},1024),t(s,{class:"align-self-end text-center",cols:"3",md:"2"},{default:a(()=>[d(u(l(A)(l(p.Api).HubrisePriceUtil.multiply(i.price,i.quantity))),1)]),_:2},1024),t(s,{cols:"3",md:"1"},{default:a(()=>[t(g,{onClick:f=>$e(r,i)},{default:a(()=>[t(x,{icon:"bx-trash"})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]))),128)),t(V,{dense:""},{default:a(()=>[t(s,{cols:"0",md:"2"}),t(s,{cols:"12",md:"5"},{default:a(()=>{var i;return[((i=l(k)[r.id])==null?void 0:i.length)>0?(y(),h(z,{key:0,class:"mt-6",color:"secondary","prepend-icon":"bx-plus",size:"x-small",onClick:f=>B(r)},{default:a(()=>[d(u(("$t"in e?e.$t:l(m))("page.order.add.section.item.button.add.itemOption")),1)]),_:2},1032,["onClick"])):U("",!0)]}),_:2},1024),t(s,{cols:"12",md:"4"},{default:a(()=>[r.customer_notes!==void 0?(y(),h(v,{key:0,modelValue:r.customer_notes,"onUpdate:modelValue":i=>r.customer_notes=i,label:("$t"in e?e.$t:l(m))("page.order.add.section.item.itemNotes"),placeholder:("$t"in e?e.$t:l(m))("page.order.add.section.item.itemNotes"),"auto-grow":"",counter:"",maxlength:"300",rows:"1",onKeyup:w(C,["enter"])},null,8,["modelValue","onUpdate:modelValue","label","placeholder"])):U("",!0)]),_:2},1024),t(s,{cols:"0",md:"1"})]),_:2},1024)],64))),128)),t(V,{dense:""},{default:a(()=>[t(s,{cols:"12"},{default:a(()=>[t(z,{class:"mt-6",color:"secondary","prepend-icon":"bx-plus",size:"small",onClick:q},{default:a(()=>[d(u(("$t"in e?e.$t:l(m))("page.order.add.section.item.button.add.item")),1)]),_:1})]),_:1}),t(s,{class:"px-4 py-8",cols:"6",md:"3"},{default:a(()=>[t(v,{modelValue:H.value,"onUpdate:modelValue":o[0]||(o[0]=r=>H.value=r),label:("$t"in e?e.$t:l(m))("page.order.add.section.item.customerNotes"),placeholder:("$t"in e?e.$t:l(m))("page.order.add.section.item.customerNotes"),"auto-grow":"",counter:"",maxlength:"500",rows:"4",onKeyup:w(C,["enter"])},null,8,["modelValue","label","placeholder"])]),_:1}),t(s,{class:"px-4 py-8",cols:"6",md:"3"},{default:a(()=>[t(M),t(v,{modelValue:P.value,"onUpdate:modelValue":o[1]||(o[1]=r=>P.value=r),label:("$t"in e?e.$t:l(m))("page.order.add.section.item.sellerNotes"),placeholder:("$t"in e?e.$t:l(m))("page.order.add.section.item.sellerNotes"),"auto-grow":"",counter:"",maxlength:"500",rows:"4",onKeyup:w(C,["enter"])},null,8,["modelValue","label","placeholder"])]),_:1}),t(s,{cols:"0",md:"1"}),t(s,{cols:"12",md:"5"},{default:a(()=>[t(V,{dense:""},{default:a(()=>[t(s,{class:"align-self-end",cols:"6",md:"5"},{default:a(()=>[d(u(("$t"in e?e.$t:l(m))("page.order.add.section.item.subtotal")),1)]),_:1}),t(s,{class:"text-center",cols:"6",md:"4"},{default:a(()=>[d(u(l(A)(l(T).subtotal)),1)]),_:1}),t(s,{cols:"0",md:"3"})]),_:1}),l(T).minimumOrderFee!==void 0?(y(),h(V,{key:0,dense:""},{default:a(()=>[t(s,{class:"align-self-end",cols:"6",md:"5"},{default:a(()=>[d(u(("$t"in e?e.$t:l(m))("page.order.add.section.item.minimumOrderFee"))+" ",1),o[3]||(o[3]=Y("br",null,null,-1)),d(" (â‰¤ "+u(R.value)+") ",1)]),_:1,__:[3]}),t(s,{class:"text-center",cols:"6",md:"4"},{default:a(()=>[d(u(l(A)(l(T).minimumOrderFee)),1)]),_:1}),t(s,{cols:"0",md:"3"})]),_:1})):U("",!0),X.serviceType===l(p.Api).HubriseServiceType.DELIVERY?(y(),h(V,{key:1,dense:""},{default:a(()=>[t(s,{class:"align-self-end",cols:"6",md:"5"},{default:a(()=>[d(u(("$t"in e?e.$t:l(m))("page.order.add.section.item.deliveryFee")),1)]),_:1}),t(s,{class:"text-center pa-0",cols:"6",md:"4"},{default:a(()=>[t(Ye,{modelValue:F.value,"onUpdate:modelValue":o[2]||(o[2]=r=>F.value=r),items:O.value,loading:O.value.length===0,class:"d-inline-flex","item-title":"name","item-value":"value",variant:"plain"},null,8,["modelValue","items","loading"])]),_:1}),t(s,{cols:"0",md:"3"})]),_:1})):U("",!0),t(V,{dense:""},{default:a(()=>[t(s,{class:"align-self-end",cols:"6",md:"5"},{default:a(()=>[d(u(("$t"in e?e.$t:l(m))("page.order.add.section.item.total")),1)]),_:1}),t(s,{class:"text-center",cols:"6",md:"4"},{default:a(()=>[d(u(l(A)(l(T).total)),1)]),_:1}),t(s,{cols:"0",md:"3"})]),_:1}),t(V,{dense:""},{default:a(()=>[t(s,{cols:"12",md:"9"},{default:a(()=>[t(z,{disabled:ye(),loading:E.value,class:"w-100",onClick:Ce},{default:a(()=>[d(u(("$t"in e?e.$t:l(m))("page.order.add.button.create")),1)]),_:1},8,["disabled","loading"])]),_:1}),t(s,{cols:"0",md:"3"})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["disabled","loading"])}}});export{dt as _};
