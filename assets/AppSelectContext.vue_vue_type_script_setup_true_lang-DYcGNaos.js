import{$ as d}from"./TranslationUtil-DaeyNtbr.js";import{bj as M,dS as A,dT as N,dU as z,b4 as S,d as J,r as p,G as K,c as P,F as Q,g as H,l as B,m as c,o as k}from"./index-DqVUQar6.js";import{$ as V}from"./api-DIDODwwU.js";import{V as T}from"./VSelect-CJxYfbxz.js";const G=()=>typeof window.navigator!="object"||typeof window.navigator.onLine!="boolean"?!0:window.navigator.onLine,x=()=>typeof document.hidden=="boolean"?document.hidden:typeof document.msHidden=="boolean"?document.msHidden:typeof document.webkitHidden=="boolean"?document.webkitHidden:!1;function O(t){return{all:t=t||new Map,on:function(s,l){var u=t.get(s);u?u.push(l):t.set(s,[l])},off:function(s,l){var u=t.get(s);u&&(l?u.splice(u.indexOf(l)>>>0,1):t.set(s,[]))},emit:function(s,l){var u=t.get(s);u&&u.slice().map(function(f){f(l)}),(u=t.get("*"))&&u.slice().map(function(f){f(s,l)})}}}const g=O(),W=M("locationStore",{state:()=>({location:void 0,locations:void 0}),getters:{getCurrentLocation:t=>t.location,getLocations:t=>t.locations},actions:{onCurrentLocationChange(t){g.on("update:location",t),t(this.location)},offCurrentLocationChange(t){g.off("update:location",t)},onLocationsChange(t){g.on("update:locations",t),t(this.locations)},offLocationsChange(t){g.off("update:locations",t)},setCurrentLocation(t){this.location=t,g.emit("update:location",this.location)},setLocations(t){this.locations=t,g.emit("update:locations",this.locations)},reset(){this.location=void 0,g.emit("update:location",this.location),this.locations=void 0,g.emit("update:locations",this.locations)}},persist:!0}),m=O(),X=M("customerListStore",{state:()=>({customerList:void 0,customerLists:void 0}),getters:{getCurrentCustomerList:t=>t.customerList,getCustomerLists:t=>t.customerLists},actions:{onCurrentCustomerListChange(t){m.on("update:customerList",t),t(this.customerList)},offCurrentCustomerListChange(t){m.off("update:customerList",t)},onCustomerListsChange(t){m.on("update:customerLists",t),t(this.customerLists)},offCustomerListsChange(t){m.off("update:customerLists",t)},setCurrentCustomerList(t){this.customerList=t,m.emit("update:customerList",this.customerList)},setCustomerLists(t){this.customerLists=t,m.emit("update:customerLists",this.customerLists)},reset(){this.customerList=void 0,m.emit("update:customerList",this.customerList),this.customerLists=void 0,m.emit("update:customerLists",this.customerLists)}},persist:!0}),C=O(),Y=M("catalogStore",{state:()=>({catalog:void 0,catalogs:void 0}),getters:{getCurrentCatalog:t=>t.catalog,getCatalogs:t=>t.catalogs},actions:{onCurrentCatalogChange(t){C.on("update:catalog",t),t(this.catalog)},offCurrentCatalogChange(t){C.off("update:catalog",t)},onCatalogsChange(t){C.on("update:catalogs",t),t(this.catalogs)},offCatalogsChange(t){C.off("update:catalogs",t)},setCurrentCatalog(t){this.catalog=t,C.emit("update:catalog",this.catalog)},setCatalogs(t){this.catalogs=t,C.emit("update:catalogs",this.catalogs)},reset(){this.catalog=void 0,C.emit("update:catalog",this.catalog),this.catalogs=void 0,C.emit("update:catalogs",this.catalogs)}},persist:!0});class Z{static info(s,l){A(u=>{u.setExtra("context",Object.assign({isOnline:G(),isHidden:x()},l)),N(s)})}static exception(s){if(x()&&s.message!==void 0&&s.message!==null&&typeof s.message=="string"&&s.message.includes("timeout")||s.message!==void 0&&s.message!==null&&typeof s.message=="string"&&s.message.includes("status code 401"))return!1;A(l=>{l.setExtra("context",{isOnline:G(),isHidden:x()}),z(s)})}}const b=async(t,s)=>!G()||typeof t.message=="string"&&t.message.includes("Network Error")?d("common.error.offline"):typeof t.message=="string"&&t.message.includes("timeout")?d("common.error.timeout"):(Z.exception(t),d("common.error.default")),R=async(t,s)=>{t.status===401&&(S("jwt",{domain:".apps.onylab.com"}).value=null,S("accessToken").value=null,S("userData").value=null,S("userAbilityRules").value=null,window.location.href="/");const l=new Error(t._data.message??"Request failed");return b(l)},st=J({__name:"AppSelectContext",props:{enableLocations:{type:Boolean,default:()=>!1},enableCustomerLists:{type:Boolean,default:()=>!1},enableCatalogs:{type:Boolean,default:()=>!1}},setup(t){const s=t,l=p(s.enableLocations),u=p(s.enableCustomerLists),f=p(s.enableCatalogs),i=W(),r=X(),n=Y(),L=p(),h=p(),y=p();L.value=i.getCurrentLocation,h.value=r.getCurrentCustomerList,y.value=n.getCurrentCatalog;const E=e=>{var a;typeof e=="string"&&(e=((a=r.getCustomerLists)==null?void 0:a.find(o=>o.id===e))??null),e!==null&&(r.setCurrentCustomerList(e),h.value=r.getCurrentCustomerList)},$=e=>{var a;typeof e=="string"&&(e=((a=n.getCatalogs)==null?void 0:a.find(o=>o.id===e))??null),e!==null&&V(`catalog?catalogId=${e.id}`,{method:"GET",onResponseError({response:o}){n.setCurrentCatalog(void 0),R(o)}}).then(o=>{n.setCurrentCatalog(o.catalog)}).catch(o=>{n.setCurrentCatalog(void 0),b(o)})},j=()=>{var e,a;f.value&&(n.getCatalogs===void 0?(n.setCatalogs(void 0),V(`catalogs?locationId=${(e=i.getCurrentLocation)==null?void 0:e.id}`,{method:"GET",onResponseError({response:o}){R(o)}}).then(o=>{var v;n.setCatalogs(o.catalogs),((v=n.getCatalogs)==null?void 0:v.length)===1&&$(n.getCatalogs[0])}).catch(o=>{b(o)})):n.getCurrentCatalog!==void 0?$(n.getCurrentCatalog):((a=n.getCatalogs)==null?void 0:a.length)===1&&$(n.getCatalogs[0]))},D=()=>{var e,a;u.value&&(r.getCustomerLists===void 0?(r.setCustomerLists(void 0),V(`customers/list?locationId=${(e=i.getCurrentLocation)==null?void 0:e.id}`,{method:"GET",onResponseError({response:o}){R(o)}}).then(o=>{var v;r.setCustomerLists(o.lists),((v=r.getCustomerLists)==null?void 0:v.length)===1&&E(r.getCustomerLists[0])}).catch(o=>{b(o)})):r.getCurrentCustomerList!==void 0?E(r.getCurrentCustomerList):((a=r.getCustomerLists)==null?void 0:a.length)===1&&E(r.getCustomerLists[0]))},w=e=>{var a;typeof e=="string"&&(e=((a=i.getLocations)==null?void 0:a.find(o=>o.id===e))??null),e!==null&&(e!==i.getCurrentLocation?(i.setCurrentLocation(e),L.value=i.getCurrentLocation,q(),I()):(D(),j()))},U=()=>{i.setLocations(void 0),V("locations",{method:"GET",onResponseError({response:e}){R(e)}}).then(e=>{var a;i.setLocations(e.locations),((a=i.getLocations)==null?void 0:a.length)===1&&w(i.getLocations[0])}).catch(e=>{b(e)})},F=()=>{L.value=void 0,i.reset(),U()},q=()=>{h.value=void 0,r.reset(),D()},I=()=>{y.value=void 0,n.reset(),j()};return K(()=>{var e;l.value&&(i.getLocations===void 0?U():i.getCurrentLocation!==void 0?w(i.getCurrentLocation):((e=i.getLocations)==null?void 0:e.length)===1&&w(i.getLocations[0]))}),(e,a)=>(k(),P(Q,null,[l.value?(k(),H(T,{key:0,modelValue:L.value,"onUpdate:modelValue":[a[0]||(a[0]=o=>L.value=o),w],disabled:c(i).getLocations===void 0,items:c(i).getLocations,label:("$t"in e?e.$t:c(d))("page.order.add.button.location.label"),loading:c(i).getLocations===void 0,placeholder:("$t"in e?e.$t:c(d))("page.order.add.button.location.placeholder"),clearable:"","item-title":"name","item-value":"id","no-data-text":"common.component.noData",style:{width:"200px"},variant:"underlined","onClick:clear":F},null,8,["modelValue","disabled","items","label","loading","placeholder"])):B("",!0),u.value?(k(),H(T,{key:1,modelValue:h.value,"onUpdate:modelValue":[a[1]||(a[1]=o=>h.value=o),E],disabled:c(r).getCustomerLists===void 0,items:c(r).getCustomerLists,label:("$t"in e?e.$t:c(d))("page.order.add.button.customerList.label"),loading:c(r).getCustomerLists===void 0,placeholder:("$t"in e?e.$t:c(d))("page.order.add.button.customerList.placeholder"),clearable:"","item-title":"name","item-value":"id","no-data-text":"common.component.noData",style:{width:"200px"},variant:"underlined","onClick:clear":q},null,8,["modelValue","disabled","items","label","loading","placeholder"])):B("",!0),f.value?(k(),H(T,{key:2,modelValue:y.value,"onUpdate:modelValue":[a[2]||(a[2]=o=>y.value=o),$],disabled:c(n).getCatalogs===void 0,items:c(n).getCatalogs,label:("$t"in e?e.$t:c(d))("page.order.add.button.catalog.label"),loading:c(n).getCatalogs===void 0,placeholder:("$t"in e?e.$t:c(d))("page.order.add.button.catalog.placeholder"),clearable:"","item-title":"name","item-value":"id","no-data-text":"common.component.noData",style:{width:"200px"},variant:"underlined","onClick:clear":I},null,8,["modelValue","disabled","items","label","loading","placeholder"])):B("",!0)],64))}});export{st as _,X as a,Y as b,b as c,R as h,W as u};
