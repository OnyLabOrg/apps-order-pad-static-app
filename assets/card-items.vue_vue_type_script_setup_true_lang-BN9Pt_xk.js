import{$ as c}from"./TranslationUtil-DpnqR49b.js";import{d as Ce,r as k,X as he,w as we,G as ke,ai as Ae,g as A,f as a,a as Ne,o as $,b as t,t as i,v as u,m as l,c as S,F as B,i as ne,l as T,di as w,e as se,q as de,$ as O,ah as P}from"./index-BCir9O6e.js";import{_ as Te}from"./AppTextarea.vue_vue_type_script_setup_true_lang-D6tvv-5d.js";import{_ as Ie}from"./AppTextField.vue_vue_type_script_setup_true_lang-Ci_sVDP3.js";import{_ as Ue}from"./AppAutocomplete.vue_vue_type_script_setup_true_lang-qqhdvRrx.js";import{c as g}from"./common-api.web.min-7qNUJA33.js";import{d as y}from"./PriceUtil-CoWoePLm.js";import{u as Le,a as Ee,b as Fe}from"./catalog-7Ad44Kqc.js";import{V as Se,c as Ke}from"./VCard-D3OBKbnM.js";import{V as He}from"./VCardText-CWv77QiI.js";import{V,a as o}from"./VRow-D-lFfhI2.js";import{c as re,a as ie,b as ue}from"./VList-BmgWss4_.js";import{V as j}from"./VSpacer-CJyLNmER.js";import{V as qe}from"./VSelect-BNdJol8Z.js";const De={class:"w-100"},Re={class:"w-100"},tt=Ce({__name:"card-items",props:{serviceType:{type:String,default:()=>g.Api.HubriseServiceType.DELIVERY},reset:{type:Number,default:()=>0}},emits:["create","nextField"],setup(Y,{emit:ce}){var le;const K=Y,x=ce,f=((le=Le().getCurrentAccount)==null?void 0:le.currency)??g.Api.HubriseCurrencyCode.EUR,z=Ee(),X=Fe(),H=k(),C=k(),U=k(!1);let G=[],I=[],M={},N={};const b=k([{}]),L=k(),E=k(),F=k(`0.00 ${f}`),J=k([{value:`0.00 ${f}`,name:y(`0.00 ${f}`)},{value:`1.00 ${f}`,name:y(`1.00 ${f}`)},{value:`2.00 ${f}`,name:y(`2.00 ${f}`)},{value:`3.00 ${f}`,name:y(`3.00 ${f}`)},{value:`4.00 ${f}`,name:y(`4.00 ${f}`)},{value:`5.00 ${f}`,name:y(`5.00 ${f}`)}]),me=()=>{if(!(!Array.isArray(b.value)||b.value.length===0))return b.value.filter(e=>"id"in e&&e.id!==void 0&&e.id!==null).length===0},q=he(()=>{const e={service_type:K.serviceType,items:b.value},n=new g.Api.TotalHubriseCalculator().calculateTotals(e,f);return F.value=n.deliveryFee,n}),Q=e=>{if(typeof e=="object"&&e!==null)switch(K.serviceType){case g.Api.HubriseServiceType.DELIVERY:return`${e.delivery}%`;case g.Api.HubriseServiceType.COLLECTION:return`${e.collection}%`;case g.Api.HubriseServiceType.EAT_IN:return`${e.eat_in}%`}return""},pe=()=>{if(C.value===void 0||C.value===null)return;const n=new g.Api.HubriseCatalogConverter().editableItems(C.value);G=n.withRef,I=n.withName},fe=()=>{if(C.value===void 0||C.value===null)return;const n=new g.Api.HubriseCatalogConverter().editableItemOptions(C.value);M=n.withRef,N=n.withName},D=()=>{b.value.push({})},ve=e=>{const n=b.value.findIndex(r=>r===e);n>=0&&b.value.splice(n,1)},R=e=>{Array.isArray(e.options)||(e.options=[]),e.options.push({})},ge=(e,n)=>{const r=e.options.findIndex(m=>m===n);r>=0&&e.options.splice(r,1)},W=(e,n)=>{const r=I==null?void 0:I.find(m=>m.id===e);r===void 0?Object.keys(n).forEach(m=>delete n[m]):(g.Util.ObjectUtil.update(n,r),Array.isArray(N[e])&&N[e].length>0?R(n):D())},Z=(e,n,r)=>{var _;const m=(_=N[e])==null?void 0:_.find(v=>v.id===n);if(m===void 0)Object.keys(r).forEach(v=>delete r[v]);else{const v=b.value.find(s=>s.id===e);g.Util.ObjectUtil.update(r,m),R(v)}},ye=()=>{U.value=!0,setTimeout(()=>U.value=!1,1e3),x("create",{items:b.value,customerNotes:L.value,sellerNotes:E.value})},ee=e=>{const n=e.target;n.tagName==="INPUT"||n.tagName==="TEXTAREA"||n.isContentEditable||(e.key==="+"||e.key==="Add"||e.code==="NumpadAdd"||e.shiftKey&&(e.key==="="||e.code==="Equal"))&&D()},te=e=>{H.value=e},ae=e=>{C.value=e,pe(),fe()},_e=(e,n,r)=>{var s;const m=n.toLowerCase(),_=(s=r.raw.category_name)==null?void 0:s.toLowerCase(),v=r.raw.product_name.toLowerCase();return(_==null?void 0:_.includes(m))||v.includes(m)},$e=(e,n)=>{const r=n.findIndex(m=>m.category_name===e.category_name&&m.product_name===e.product_name);return r===0||n[r-1].category_name!==e.category_name},be=(e,n,r)=>{const m=n.toLowerCase(),_=r.raw.option_list_name.toLowerCase(),v=r.raw.name.toLowerCase();return _.includes(m)||v.includes(m)},Ve=(e,n)=>{const r=n.findIndex(m=>m.option_list_name===e.option_list_name&&m.name===e.name);return r===0||n[r-1].option_list_name!==e.option_list_name},h=e=>{x("nextField",e)};return we(()=>K.reset,()=>{b.value=[],L.value="",E.value="",F.value=`0.00 ${f}`,U.value=!1}),ke(()=>{window.addEventListener("keydown",ee),z.onCurrentLocationChange(te),X.onCurrentCatalogChange(ae)}),Ae(()=>{window.removeEventListener("keydown",ee),z.offCurrentLocationChange(te),X.offCurrentCatalogChange(ae)}),(e,n)=>{const r=Ue,m=Ie,_=Ne("IconBtn"),v=Te;return $(),A(Se,{disabled:!H.value||!C.value,loading:!H.value||!C.value},{default:a(()=>[t(Ke,null,{default:a(()=>[i(u(("$t"in e?e.$t:l(c))("page.order.add.section.item.title")),1)]),_:1}),t(He,null,{default:a(()=>[t(V,{dense:""},{default:a(()=>[t(o,{cols:"2",md:"2"},{default:a(()=>[i(u(("$t"in e?e.$t:l(c))("page.order.add.section.item.reference")),1)]),_:1}),t(o,{cols:"2",md:"4"},{default:a(()=>[i(u(("$t"in e?e.$t:l(c))("page.order.add.section.item.name")),1)]),_:1}),t(o,{cols:"2",md:"1"},{default:a(()=>[i(u(("$t"in e?e.$t:l(c))("page.order.add.section.item.quantity")),1)]),_:1}),t(o,{cols:"2",md:"1"},{default:a(()=>[i(u(("$t"in e?e.$t:l(c))("page.order.add.section.item.vat")),1)]),_:1}),t(o,{cols:"1",md:"1"},{default:a(()=>[i(u(("$t"in e?e.$t:l(c))("page.order.add.section.item.price")),1)]),_:1}),t(o,{class:"text-center",cols:"2",md:"2"},{default:a(()=>[i(u(("$t"in e?e.$t:l(c))("page.order.add.section.item.subtotal")),1)]),_:1}),t(o,{cols:"1",md:"1"})]),_:1}),($(!0),S(B,null,ne(b.value,s=>($(),S(B,{key:s.id},[t(V,{dense:""},{default:a(()=>[t(o,{cols:"4",md:"2"},{default:a(()=>[s.sku_ref!==null?($(),A(r,{key:0,modelValue:s.sku_ref,"onUpdate:modelValue":[d=>s.sku_ref=d,d=>W(d,s)],items:l(G),placeholder:("$t"in e?e.$t:l(c))("page.order.add.section.item.reference"),"item-title":"sku_ref","item-value":"id","no-data-text":"common.component.noData",onKeyup:w(h,["enter"])},null,8,["modelValue","onUpdate:modelValue","items","placeholder"])):T("",!0)]),_:2},1024),t(o,{cols:"6",md:"4"},{default:a(()=>[t(r,{modelValue:s.product_name,"onUpdate:modelValue":[d=>s.product_name=d,d=>W(d,s)],"custom-filter":_e,items:l(I),placeholder:("$t"in e?e.$t:l(c))("page.order.add.section.item.name"),"item-title":"product_name","item-value":"id","no-data-text":"common.component.noData",onKeyup:w(h,["enter"])},{item:a(({props:d,item:p})=>[se("div",De,[$e(p.raw,l(I))?($(),A(re,{key:0,class:"text-primary font-weight-bold"},{default:a(()=>[i(u(p.raw.category_name),1)]),_:2},1024)):T("",!0),t(ie,de({class:"ps-8",ref_for:!0},d),{default:a(()=>[t(ue)]),_:2},1040)])]),selection:a(({item:d})=>[i(u(d.title),1)]),_:2},1032,["modelValue","onUpdate:modelValue","items","placeholder"])]),_:2},1024),t(o,{cols:"2",md:"1"},{default:a(()=>[t(m,{modelValue:s.quantity,"onUpdate:modelValue":d=>s.quantity=d,clearable:!1,min:"1",placeholder:"1",type:"number",onKeyup:w(h,["enter"])},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(o,{class:"align-self-end",cols:"3",md:"1"},{default:a(()=>[i(u(Q(s.tax_rate)),1)]),_:2},1024),t(o,{class:"align-self-end",cols:"3",md:"1"},{default:a(()=>[i(u(l(y)(s.price)),1)]),_:2},1024),t(o,{class:"align-self-end text-center",cols:"3",md:"2"},{default:a(()=>[i(u(l(y)(l(g.Api).HubrisePriceUtil.multiply(s.price,s.quantity))),1)]),_:2},1024),t(o,{class:"px-0",cols:"3",md:"1"},{default:a(()=>[t(_,{"x-small":"",onClick:d=>s.customer_notes=s.customer_notes===void 0?null:void 0},{default:a(()=>[t(O,{icon:"bx-edit"})]),_:2},1032,["onClick"]),t(_,{onClick:d=>ve(s)},{default:a(()=>[t(O,{icon:"bx-trash"})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024),($(!0),S(B,null,ne(s.options,d=>($(),S("div",{key:d.ref},[t(V,{dense:""},{default:a(()=>[t(o,{class:"d-flex align-self-end",cols:"4",md:"2"},{default:a(()=>[t(j),d.ref!==null?($(),A(r,{key:0,modelValue:d.ref,"onUpdate:modelValue":[p=>d.ref=p,p=>Z(s.id,p,d)],items:l(M)[s.id],placeholder:("$t"in e?e.$t:l(c))("page.order.add.section.item.reference"),"item-title":"ref","item-value":"id","no-data-text":"common.component.noData",onKeyup:w(h,["enter"])},null,8,["modelValue","onUpdate:modelValue","items","placeholder"])):T("",!0)]),_:2},1024),t(o,{class:"d-flex align-self-end",cols:"6",md:"4"},{default:a(()=>[t(j),t(r,{modelValue:d.name,"onUpdate:modelValue":[p=>d.name=p,p=>Z(s.id,p,d)],"custom-filter":be,items:l(N)[s.id],placeholder:("$t"in e?e.$t:l(c))("page.order.add.section.item.name"),"item-title":"name","item-value":"id","no-data-text":"common.component.noData",onKeyup:w(h,["enter"])},{item:a(({props:p,item:oe})=>[se("div",Re,[Ve(oe.raw,l(N)[s.id])?($(),A(re,{key:0,class:"text-primary font-weight-bold"},{default:a(()=>[i(u(oe.raw.option_list_name),1)]),_:2},1024)):T("",!0),t(ie,de({class:"ps-8",ref_for:!0},p),{default:a(()=>[t(ue)]),_:2},1040)])]),selection:a(({item:p})=>[i(u(p.title),1)]),_:2},1032,["modelValue","onUpdate:modelValue","items","placeholder"])]),_:2},1024),t(o,{class:"d-flex align-self-end",cols:"2",md:"1"},{default:a(()=>[t(m,{modelValue:d.quantity,"onUpdate:modelValue":p=>d.quantity=p,clearable:!1,min:"1",placeholder:"1",type:"number",onKeyup:w(h,["enter"])},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(o,{class:"align-self-end",cols:"3",md:"1"},{default:a(()=>[i(u(Q(s.tax_rate)),1)]),_:2},1024),t(o,{class:"align-self-end",cols:"3",md:"1"},{default:a(()=>[i(u(l(y)(d.price)),1)]),_:2},1024),t(o,{class:"align-self-end text-center",cols:"3",md:"2"},{default:a(()=>[i(u(l(y)(l(g.Api).HubrisePriceUtil.multiply(d.price,d.quantity))),1)]),_:2},1024),t(o,{cols:"3",md:"1"},{default:a(()=>[t(_,{onClick:p=>ge(s,d)},{default:a(()=>[t(O,{icon:"bx-trash"})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]))),128)),t(V,{dense:""},{default:a(()=>[t(o,{cols:"0",md:"2"}),t(o,{cols:"12",md:"5"},{default:a(()=>{var d;return[((d=l(N)[s.id])==null?void 0:d.length)>0?($(),A(P,{key:0,class:"mt-6",color:"secondary","prepend-icon":"bx-plus",size:"x-small",onClick:p=>R(s)},{default:a(()=>[i(u(("$t"in e?e.$t:l(c))("page.order.add.section.item.button.add.itemOption")),1)]),_:2},1032,["onClick"])):T("",!0)]}),_:2},1024),t(o,{cols:"12",md:"4"},{default:a(()=>[s.customer_notes!==void 0?($(),A(v,{key:0,modelValue:s.customer_notes,"onUpdate:modelValue":d=>s.customer_notes=d,label:("$t"in e?e.$t:l(c))("page.order.add.section.item.itemNotes"),placeholder:("$t"in e?e.$t:l(c))("page.order.add.section.item.itemNotes"),"auto-grow":"",counter:"",maxlength:"300",rows:"1",onKeyup:w(h,["enter"])},null,8,["modelValue","onUpdate:modelValue","label","placeholder"])):T("",!0)]),_:2},1024),t(o,{cols:"0",md:"1"})]),_:2},1024)],64))),128)),t(V,{dense:""},{default:a(()=>[t(o,{cols:"12"},{default:a(()=>[t(P,{class:"mt-6",color:"secondary","prepend-icon":"bx-plus",size:"small",onClick:D},{default:a(()=>[i(u(("$t"in e?e.$t:l(c))("page.order.add.section.item.button.add.item")),1)]),_:1})]),_:1}),t(o,{class:"px-4 py-8",cols:"6",md:"3"},{default:a(()=>[t(v,{modelValue:L.value,"onUpdate:modelValue":n[0]||(n[0]=s=>L.value=s),label:("$t"in e?e.$t:l(c))("page.order.add.section.item.customerNotes"),placeholder:("$t"in e?e.$t:l(c))("page.order.add.section.item.customerNotes"),"auto-grow":"",counter:"",maxlength:"500",rows:"4",onKeyup:w(h,["enter"])},null,8,["modelValue","label","placeholder"])]),_:1}),t(o,{class:"px-4 py-8",cols:"6",md:"3"},{default:a(()=>[t(j),t(v,{modelValue:E.value,"onUpdate:modelValue":n[1]||(n[1]=s=>E.value=s),label:("$t"in e?e.$t:l(c))("page.order.add.section.item.sellerNotes"),placeholder:("$t"in e?e.$t:l(c))("page.order.add.section.item.sellerNotes"),"auto-grow":"",counter:"",maxlength:"500",rows:"4",onKeyup:w(h,["enter"])},null,8,["modelValue","label","placeholder"])]),_:1}),t(o,{cols:"0",md:"1"}),t(o,{cols:"12",md:"5"},{default:a(()=>[t(V,{dense:""},{default:a(()=>[t(o,{class:"align-self-end",cols:"6",md:"5"},{default:a(()=>[i(u(("$t"in e?e.$t:l(c))("page.order.add.section.item.subtotal")),1)]),_:1}),t(o,{class:"text-center",cols:"6",md:"4"},{default:a(()=>[i(u(l(y)(l(q).subtotal)),1)]),_:1}),t(o,{cols:"0",md:"3"})]),_:1}),t(V,{dense:""},{default:a(()=>[t(o,{class:"align-self-end",cols:"6",md:"5"},{default:a(()=>[i(u(("$t"in e?e.$t:l(c))("page.order.add.section.item.minimumOrderFee")),1)]),_:1}),t(o,{class:"text-center",cols:"6",md:"4"},{default:a(()=>[i(u(l(y)(l(q).minimumOrderFee)),1)]),_:1}),t(o,{cols:"0",md:"3"})]),_:1}),Y.serviceType===l(g.Api).HubriseServiceType.DELIVERY?($(),A(V,{key:0,dense:""},{default:a(()=>[t(o,{class:"align-self-end",cols:"6",md:"5"},{default:a(()=>[i(u(("$t"in e?e.$t:l(c))("page.order.add.section.item.deliveryFee")),1)]),_:1}),t(o,{class:"text-center pa-0",cols:"6",md:"4"},{default:a(()=>[t(qe,{modelValue:F.value,"onUpdate:modelValue":n[2]||(n[2]=s=>F.value=s),disabled:!0,items:J.value,loading:J.value.length===0,class:"d-inline-flex","item-title":"name","item-value":"value",variant:"plain"},null,8,["modelValue","items","loading"])]),_:1}),t(o,{cols:"0",md:"3"})]),_:1})):T("",!0),t(V,{dense:""},{default:a(()=>[t(o,{class:"align-self-end",cols:"6",md:"5"},{default:a(()=>[i(u(("$t"in e?e.$t:l(c))("page.order.add.section.item.total")),1)]),_:1}),t(o,{class:"text-center",cols:"6",md:"4"},{default:a(()=>[i(u(l(y)(l(q).total)),1)]),_:1}),t(o,{cols:"0",md:"3"})]),_:1}),t(V,{dense:""},{default:a(()=>[t(o,{cols:"12",md:"9"},{default:a(()=>[t(P,{disabled:me(),loading:U.value,class:"w-100",onClick:ye},{default:a(()=>[i(u(("$t"in e?e.$t:l(c))("page.order.add.button.create")),1)]),_:1},8,["disabled","loading"])]),_:1}),t(o,{cols:"0",md:"3"})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["disabled","loading"])}}});export{tt as _};
